{
    "cells": [
        {
            "language": "markdown",
            "source": [
                "# Classification"
            ],
            "outputs": []
        },
        {
            "language": "markdown",
            "source": [
                "## Intro"
            ],
            "outputs": []
        },
        {
            "language": "markdown",
            "source": [
                "| Hyperparameters | Binary Classification | Multilabel Binary Classification | Multiclass classification |\r\n|-|-|-|-|\r\n| Input shape | Same as # of features | Same as # of features | Same as # of features |\r\n| Hidden layers | Problem specific, minimum = 1, max = unlimited | Sames as binary classification | Sames as binary classification |\r\n| # neurons per hidden layer | Problem specific, generally 10 to 100 | Sames as binary classification | Same as binary classification |\r\n| Hidden activation | Usually ReLU | Usually ReLU | Usually ReLU |\r\n| Output shape | 1 | 1 per label | 1 per class |\r\n| Output layer activation | sigmoid | sigmoid | softmax |\r\n| Loss function | Cross entropy | Cross entropy | Cross entropy |\r\n| Optimizer | SGD, Adam | SGD, Adam | SGD, Adam |\r\n| Learning rate| Adam 1e-4 | Adam 1e-4 | Adam 1e-4 |\r\n\r\nUse the hyperparameters above as a starting point."
            ],
            "outputs": []
        },
        {
            "language": "markdown",
            "source": [
                "## Import Tensorflow"
            ],
            "outputs": []
        },
        {
            "language": "typescript",
            "source": [
                "var tf = require(\"@tensorflow/tfjs-node\") as typeof import(\"@tensorflow/tfjs-node\");\r\n\r\ntf.version"
            ],
            "outputs": [
                {
                    "items": [
                        {
                            "mime": "application/vnd.code.notebook.stderr",
                            "value": [
                                "2022-01-23 23:49:45.340258: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2\r",
                                "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\r",
                                ""
                            ]
                        }
                    ]
                },
                {
                    "items": [
                        {
                            "mime": "application/vnd.code.notebook.stdout",
                            "value": [
                                "",
                                ""
                            ]
                        }
                    ]
                },
                {
                    "items": [
                        {
                            "mime": "text/plain",
                            "value": [
                                "{",
                                "  \u001b[32m'tfjs-core'\u001b[39m: \u001b[32m'3.13.0'\u001b[39m,",
                                "  \u001b[32m'tfjs-backend-cpu'\u001b[39m: \u001b[32m'3.13.0'\u001b[39m,",
                                "  \u001b[32m'tfjs-backend-webgl'\u001b[39m: \u001b[32m'3.13.0'\u001b[39m,",
                                "  \u001b[32m'tfjs-data'\u001b[39m: \u001b[32m'3.13.0'\u001b[39m,",
                                "  \u001b[32m'tfjs-layers'\u001b[39m: \u001b[32m'3.13.0'\u001b[39m,",
                                "  \u001b[32m'tfjs-converter'\u001b[39m: \u001b[32m'3.13.0'\u001b[39m,",
                                "  tfjs: \u001b[32m'3.13.0'\u001b[39m,",
                                "  \u001b[32m'tfjs-node'\u001b[39m: \u001b[32m'3.13.0'\u001b[39m",
                                "}"
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "language": "markdown",
            "source": [
                "## Dataset"
            ],
            "outputs": []
        },
        {
            "language": "markdown",
            "source": [
                "### Convert ubyte to array"
            ],
            "outputs": []
        },
        {
            "language": "typescript",
            "source": [
                "// const convert = require(\"./util/fashion-mnist-to-array\");\r\n\r\n// await convert();"
            ],
            "outputs": [
                {
                    "items": [
                        {
                            "mime": "application/vnd.code.notebook.stdout",
                            "value": [
                                "",
                                ""
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "language": "markdown",
            "source": [
                "### Load train dataset"
            ],
            "outputs": []
        },
        {
            "language": "typescript",
            "source": [
                "const loadJSON = require(\"./util/loadjson\");\r\n\r\nfunction load(datasetName, labelNumber, xs, ys) {\r\n  const x = loadJSON(\r\n    `./data/digits/fashion-mnist/${datasetName}-${labelNumber}.json`\r\n  );\r\n  const y = Array(x.length).fill(labelNumber);\r\n  xs.push(...x);\r\n  ys.push(...y);\r\n}"
            ],
            "outputs": [
                {
                    "items": [
                        {
                            "mime": "application/vnd.code.notebook.stdout",
                            "value": [
                                "",
                                ""
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "language": "typescript",
            "source": [
                "const xTrain = [];\r\nconst yTrain = [];\r\nconst xTest = [];\r\nconst yTest = [];\r\ntry {\r\n  for (let label = 0; label <= 9; label++) {\r\n    console.log(`Loading training & test datasets with label ${label}...`);\r\n    load(\"training\", label, xTrain, yTrain);\r\n    load(\"test\", label, xTest, yTest);\r\n  }\r\n} catch (e) {\r\n  console.error(e);\r\n}\r\n"
            ],
            "outputs": [
                {
                    "items": [
                        {
                            "mime": "application/vnd.code.notebook.stdout",
                            "value": [
                                "Loading training & test datasets with label 0...",
                                "Loading training & test datasets with label 1...",
                                "Loading training & test datasets with label 2...",
                                "Loading training & test datasets with label 3...",
                                "Loading training & test datasets with label 4...",
                                "Loading training & test datasets with label 5...",
                                "Loading training & test datasets with label 6...",
                                "Loading training & test datasets with label 7...",
                                "Loading training & test datasets with label 8...",
                                "Loading training & test datasets with label 9...",
                                "",
                                ""
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "language": "markdown",
            "source": [
                "## Visualize dataset"
            ],
            "outputs": []
        },
        {
            "language": "typescript",
            "source": [
                "const showGrayscaleImage = require(\"./util/showGrayscaleImage\");\r\nshowGrayscaleImage(xTest[4], 28, 28);"
            ],
            "outputs": [
                {
                    "items": [
                        {
                            "mime": "application/vnd.code.notebook.stdout",
                            "value": [
                                "",
                                ""
                            ]
                        }
                    ]
                },
                {
                    "items": [
                        {
                            "mime": "image/png",
                            "value": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAABmJLR0QA/wD/AP+gvaeTAAAE+0lEQVRIiZWWS4sTTRSGn+pbkk6i3bkwXgYhIIMujOBqVl42gxt/guCfcq9/wYWIG5FBmUFRkFFcDFmICy+YTJJOMn2pqm/hV2X3XPD7DoR0V1ed95z3nHqrBKA5xS5cuMDGxgZbW1u8evWKp0+fonV1ervd5tatW9y+fZuPHz+yvb3N/v7+aS7xjg44jsOdO3e4fv063W6X0WiEUopHjx4xmUwYjUZkWcZyuaRWq9Hv9+l2uzx+/JjxeMz9+/dZLpfs7e3x4sULlsslQggbqAB0eeDBgwc0Gg2+fPlCURQ4jsPPnz8ZDofcu3ePGzducOnSJfI85+DggJcvX/Ls2TP29vbodDpIKfE8j36/TxRFPHz40PpRSv0GNC9XrlxhfX2dyWRCs9mk0WjQbDaZTqd8+/aNIAgYDAZsbGywvr7OaDRiZ2cHKSVRFFGv19FaMx6PWSwWnDlzhsViwdu3by2DwtTQdV3u3r3L9+/fCYIAz/PwPI8wDJnNZrRaLX79+sVoNGI+n9NsNomiiF6vR6vVwnVd8jzH933SNAVgNptx7tw5dnd3GY/HVcBr167R6XRIkoSiKKjX63ieh+u6NJtN5vM5URShlCIIAsIwZDwe43keQRCQpikXL17kzZs3BEGAEILDw0NarRZ5nrO7u/unafr9PnEcMx6PieOYJEmYz+dsbW0hpSQMQ86fP8/a2hpPnjwhjmOGwyE7Ozvkec7Vq1d59+6dXdtqtUjTlDiOWa1WNBoNLl++zP7+/u8MB4MBg8GA6XRKs9nkx48f+L5PHMcAxHHMbDajVquRJAm+7/+mRwgAS+NisUBKiRCC6XRKr9dDa43ruhwcHPDp06c/lPb7fYbDIavVislkwnw+RwhBp9MhDMOK8/IW0lpTFAW+75PnOZPJhCRJqNfrRFFEu93m69evfP78uVpDgCAIuHnzJmEY0ul02N7exvd9oigiz3MLasx1XZRSaK2RUlIUBbPZjM3NTfI8J01TXr9+zWQyOd6l5b0IsLm5SZZlTKdTwjDEcRzK84QQNkOlFEVR2P/BYMDz589PEhoc82CcGPvw4YPNynXdyiIzz6qHEPi+j9aaWq3G+/fvLeVCiIpfp+yonOHh4aHdyEIIpJQApGlq6cvz3NZQa20BlVIAlu6y3wpg2ZRSLJdLgiAgyzLrxPM8G7nJ3NTQcRyklCyXywoTJ1J6mnmeZ7MzNCmlLKiJ3szRWpNl2en+jg6UnRhKykDGseu6OI5j61ymzrBxkh3LsMy3qWFRFJZC13UrAGZju65rTwrT0f8J8Ci4Uspmc/TwNSaltHV2HIcgCP47oCm04zgURUGWZTZiKeWpoL7vI4Qgy7KKGv0V0FgYhriuaykTQpxaGyEE9XodpRRZlv2/DI11u12KogCwdSwDlDe01tqegWatGS+vORHQTIrjmCzL8DzP7rNys0gpUUrZn5G61WpFu922WR5VpQqg+Viv1xFCUBQFnudZZ5WF/76XNbbc1VEU/Z1S46zX65GmaUUry9+NtEkpbaZGaXzfZ7FY0Ol0jtFaASzL0NraGqvV6kTRNk1Uq9UIgoAgCGyHrlYrS7e5ohz1fayGZe000RlxFkKQ53nl4DVZaq3tXcZ089mzZ0+n1ETR6/Xsra18ShgzWZe3SFl1yhJnaC2b1VIDaKgxNTGyZZ4N6GkC4DgOnueRJEklIGP/AHvQ894vNRPUAAAAAElFTkSuQmCC"
                        },
                        {
                            "mime": "text/plain",
                            "value": [
                                "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAABmJLR0QA/wD/AP+gvaeTAAAE+0lEQVRIiZWWS4sTTRSGn+pbkk6i3bkwXgYhIIMujOBqVl42gxt/guCfcq9/wYWIG5FBmUFRkFFcDFmICy+YTJJOMn2pqm/hV2X3XPD7DoR0V1ed95z3nHqrBKA5xS5cuMDGxgZbW1u8evWKp0+fonV1ervd5tatW9y+fZuPHz+yvb3N/v7+aS7xjg44jsOdO3e4fv063W6X0WiEUopHjx4xmUwYjUZkWcZyuaRWq9Hv9+l2uzx+/JjxeMz9+/dZLpfs7e3x4sULlsslQggbqAB0eeDBgwc0Gg2+fPlCURQ4jsPPnz8ZDofcu3ePGzducOnSJfI85+DggJcvX/Ls2TP29vbodDpIKfE8j36/TxRFPHz40PpRSv0GNC9XrlxhfX2dyWRCs9mk0WjQbDaZTqd8+/aNIAgYDAZsbGywvr7OaDRiZ2cHKSVRFFGv19FaMx6PWSwWnDlzhsViwdu3by2DwtTQdV3u3r3L9+/fCYIAz/PwPI8wDJnNZrRaLX79+sVoNGI+n9NsNomiiF6vR6vVwnVd8jzH933SNAVgNptx7tw5dnd3GY/HVcBr167R6XRIkoSiKKjX63ieh+u6NJtN5vM5URShlCIIAsIwZDwe43keQRCQpikXL17kzZs3BEGAEILDw0NarRZ5nrO7u/unafr9PnEcMx6PieOYJEmYz+dsbW0hpSQMQ86fP8/a2hpPnjwhjmOGwyE7Ozvkec7Vq1d59+6dXdtqtUjTlDiOWa1WNBoNLl++zP7+/u8MB4MBg8GA6XRKs9nkx48f+L5PHMcAxHHMbDajVquRJAm+7/+mRwgAS+NisUBKiRCC6XRKr9dDa43ruhwcHPDp06c/lPb7fYbDIavVislkwnw+RwhBp9MhDMOK8/IW0lpTFAW+75PnOZPJhCRJqNfrRFFEu93m69evfP78uVpDgCAIuHnzJmEY0ul02N7exvd9oigiz3MLasx1XZRSaK2RUlIUBbPZjM3NTfI8J01TXr9+zWQyOd6l5b0IsLm5SZZlTKdTwjDEcRzK84QQNkOlFEVR2P/BYMDz589PEhoc82CcGPvw4YPNynXdyiIzz6qHEPi+j9aaWq3G+/fvLeVCiIpfp+yonOHh4aHdyEIIpJQApGlq6cvz3NZQa20BlVIAlu6y3wpg2ZRSLJdLgiAgyzLrxPM8G7nJ3NTQcRyklCyXywoTJ1J6mnmeZ7MzNCmlLKiJ3szRWpNl2en+jg6UnRhKykDGseu6OI5j61ymzrBxkh3LsMy3qWFRFJZC13UrAGZju65rTwrT0f8J8Ci4Uspmc/TwNSaltHV2HIcgCP47oCm04zgURUGWZTZiKeWpoL7vI4Qgy7KKGv0V0FgYhriuaykTQpxaGyEE9XodpRRZlv2/DI11u12KogCwdSwDlDe01tqegWatGS+vORHQTIrjmCzL8DzP7rNys0gpUUrZn5G61WpFu922WR5VpQqg+Viv1xFCUBQFnudZZ5WF/76XNbbc1VEU/Z1S46zX65GmaUUry9+NtEkpbaZGaXzfZ7FY0Ol0jtFaASzL0NraGqvV6kTRNk1Uq9UIgoAgCGyHrlYrS7e5ohz1fayGZe000RlxFkKQ53nl4DVZaq3tXcZ089mzZ0+n1ETR6/Xsra18ShgzWZe3SFl1yhJnaC2b1VIDaKgxNTGyZZ4N6GkC4DgOnueRJEklIGP/AHvQ894vNRPUAAAAAElFTkSuQmCC"
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "language": "typescript",
            "source": [
                "showGrayscaleImage(xTrain[4], 28, 28)"
            ],
            "outputs": [
                {
                    "items": [
                        {
                            "mime": "application/vnd.code.notebook.stdout",
                            "value": [
                                "",
                                ""
                            ]
                        }
                    ]
                },
                {
                    "items": [
                        {
                            "mime": "image/png",
                            "value": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAABmJLR0QA/wD/AP+gvaeTAAAEMklEQVRIiZ2WvW4TTRSGn/lZ73p3wZCNETJIgUgI0XAFoBRJASUFl8B9fCUtUkrS0SDugRKBUBoaREFAKUBCmMhOrN31zuxQoJnYCY7JdyRL1u6Z8573PT87AO5ff0VROK31Uj8hhJNSLnq//PCDBw/czs6O29vbc0dHR84Y47a3t92bN2/c27dv3Wg0cu/evXN37949dfZUPI960tbW1nj58iVZltHr9WjbluFwSKfTYW1tjf39fdbX13HOsbu7y4ULF4iiiCRJeP78OU+fPgVACIFzxxALAV+/fs21a9c4ODgAoG1b2ralrmsmkwmrq6sMh0NGoxG9Xg+lVAieZRlKKe7du3cqrgL+O/nwyZMnbG5u8uvXL6SUtG17nKEQCCGw1tLpdOh2u8RxHMCqquLHjx9YazHG8PHjx7nYf2W4u7tLkiQcHh4CUNc1QggAnHMYYwCw1qKUYjqdYoyhqiqiKOLw8JAkSdBa8+jRo7nY8m9yAiiliKKIPM+x1mKtpWkajDG0bYu1NoA759Ba0+12McZQliV1XdPv9xkMBmcD7uzskKYpaZpy+/ZtiqIIUsGfWjrnsNaGunpwgKZpuHr1Kuvr60wmEzY2Ns4G3N7eJs9zptMpaZpSFAVZliGlDCDOuQDqnKNpGsbjMT9//uTg4ICbN2/S7/fJsoz79+8vryHAq1ev2Nra4vPnzwwGAz59+kTbtpRlSRRFWGuJooiyLAEYjUZkWcbXr1+5c+cOw+GQZ8+e8f79+7m4elENHz9+DMCLFy+4cuUKcRxTVRXOucDWOYcQAq11qN3169d5+PDhorCLm8abtRYpJWVZ0ul0/hySMrwTQiClRAiBUgqtjzn45+cCvHjxYvivtQ5SemZ+4H0Ck8kk+Pt6z9pCSb2trKxQliVaa9q2RUqJUgr4Mzq+S5VSNE1DXddnxlvKsCgKxuMx3W6Xuq4DoM/cs+52uzjnODo6Oj/grO5KKaqqIk1TmqaZk9AzlVISx/Fc156s3T8zjKIIrTVJkjCdTsPenG0Q3zxxHJ+q2bkZJklCkiRhrXk5fQf6kVBKYa3l8uXLAAuBlzLc399HShlmUGsdAL28cRwDx/v33Az9nAkhSNMUY8xc/bwCnU5nTlrnXKjrSaX+iaEH8EvaB1ZKhaQ8gDGGNE3PZLcUMEmSsMaMMUFOpVSYQSllSKRpGvI8Pz9D75hl2bHjzPz5QZ9dY75plrE8k2Gv10NKGZrEd6YxJoyGT8RL+7+aZpahB/T3mtm1BhDHMVrrAOxru8jO3KVZls114HQ6nQOsqgqlVNif1lq+fft26mq4FNA753mOEIKiKBgMBozH47mBt9aitabf76OU4suXLxRFwaVLl8L18qT99Ys/m+GtW7e4ceMGq6urJElCnufh0usXwXg85vv370wmE/b29vjw4cOpON5+A9IuR/1LCUjuAAAAAElFTkSuQmCC"
                        },
                        {
                            "mime": "text/plain",
                            "value": [
                                "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAABmJLR0QA/wD/AP+gvaeTAAAEMklEQVRIiZ2WvW4TTRSGn/lZ73p3wZCNETJIgUgI0XAFoBRJASUFl8B9fCUtUkrS0SDugRKBUBoaREFAKUBCmMhOrN31zuxQoJnYCY7JdyRL1u6Z8573PT87AO5ff0VROK31Uj8hhJNSLnq//PCDBw/czs6O29vbc0dHR84Y47a3t92bN2/c27dv3Wg0cu/evXN37949dfZUPI960tbW1nj58iVZltHr9WjbluFwSKfTYW1tjf39fdbX13HOsbu7y4ULF4iiiCRJeP78OU+fPgVACIFzxxALAV+/fs21a9c4ODgAoG1b2ralrmsmkwmrq6sMh0NGoxG9Xg+lVAieZRlKKe7du3cqrgL+O/nwyZMnbG5u8uvXL6SUtG17nKEQCCGw1tLpdOh2u8RxHMCqquLHjx9YazHG8PHjx7nYf2W4u7tLkiQcHh4CUNc1QggAnHMYYwCw1qKUYjqdYoyhqiqiKOLw8JAkSdBa8+jRo7nY8m9yAiiliKKIPM+x1mKtpWkajDG0bYu1NoA759Ba0+12McZQliV1XdPv9xkMBmcD7uzskKYpaZpy+/ZtiqIIUsGfWjrnsNaGunpwgKZpuHr1Kuvr60wmEzY2Ns4G3N7eJs9zptMpaZpSFAVZliGlDCDOuQDqnKNpGsbjMT9//uTg4ICbN2/S7/fJsoz79+8vryHAq1ev2Nra4vPnzwwGAz59+kTbtpRlSRRFWGuJooiyLAEYjUZkWcbXr1+5c+cOw+GQZ8+e8f79+7m4elENHz9+DMCLFy+4cuUKcRxTVRXOucDWOYcQAq11qN3169d5+PDhorCLm8abtRYpJWVZ0ul0/hySMrwTQiClRAiBUgqtjzn45+cCvHjxYvivtQ5SemZ+4H0Ck8kk+Pt6z9pCSb2trKxQliVaa9q2RUqJUgr4Mzq+S5VSNE1DXddnxlvKsCgKxuMx3W6Xuq4DoM/cs+52uzjnODo6Oj/grO5KKaqqIk1TmqaZk9AzlVISx/Fc156s3T8zjKIIrTVJkjCdTsPenG0Q3zxxHJ+q2bkZJklCkiRhrXk5fQf6kVBKYa3l8uXLAAuBlzLc399HShlmUGsdAL28cRwDx/v33Az9nAkhSNMUY8xc/bwCnU5nTlrnXKjrSaX+iaEH8EvaB1ZKhaQ8gDGGNE3PZLcUMEmSsMaMMUFOpVSYQSllSKRpGvI8Pz9D75hl2bHjzPz5QZ9dY75plrE8k2Gv10NKGZrEd6YxJoyGT8RL+7+aZpahB/T3mtm1BhDHMVrrAOxru8jO3KVZls114HQ6nQOsqgqlVNif1lq+fft26mq4FNA753mOEIKiKBgMBozH47mBt9aitabf76OU4suXLxRFwaVLl8L18qT99Ys/m+GtW7e4ceMGq6urJElCnufh0usXwXg85vv370wmE/b29vjw4cOpON5+A9IuR/1LCUjuAAAAAElFTkSuQmCC"
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "language": "markdown",
            "source": [
                "## Model"
            ],
            "outputs": []
        },
        {
            "language": "markdown",
            "source": [
                "### Create Model"
            ],
            "outputs": []
        },
        {
            "language": "typescript",
            "source": [
                "const numberOfFeatures = xTrain[0].length;\r\nconst metrics = [];\r\nlet cycle = 0;\r\n\r\nconst model = tf.sequential({\r\n  layers: [\r\n    tf.layers.dense({\r\n      units: 6,\r\n      name: \"inputLayer\",\r\n      activation: \"relu\",\r\n      inputShape: [numberOfFeatures]\r\n    }),\r\n    // tf.layers.dense({ units: 16, activation: \"relu\" }),\r\n    tf.layers.dense({ units: 2, activation: \"softmax\", name: \"outputLayer\" })\r\n  ]\r\n});\r\n\r\nmodel.compile({\r\n  optimizer: tf.train.adam(0.001),\r\n  // optimizer: tf.train.sgd(0.01),\r\n  loss: tf.losses.softmaxCrossEntropy,\r\n  metrics: [\"accuracy\"]\r\n});\r\n\r\nnumberOfFeatures;"
            ],
            "outputs": [
                {
                    "items": [
                        {
                            "mime": "application/vnd.code.notebook.stdout",
                            "value": [
                                "",
                                ""
                            ]
                        }
                    ]
                },
                {
                    "items": [
                        {
                            "mime": "text/plain",
                            "value": [
                                "\u001b[33m8\u001b[39m"
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "language": "markdown",
            "source": [
                "### Training"
            ],
            "outputs": []
        },
        {
            "language": "typescript",
            "source": [
                "try {\r\n  cycle += 1;\r\n  const trainResult = await model.fit(tf.tensor2d(xTrain), tf.tensor2d(yTrain), {\r\n    epochs: 100,\r\n    verbose: 0,\r\n    // shuffle: true,\r\n    // validationSplit: 0.9\r\n  });\r\n} catch (e) {\r\n  console.error(e)\r\n}"
            ],
            "outputs": [
                {
                    "items": [
                        {
                            "mime": "application/vnd.code.notebook.stdout",
                            "value": [
                                "",
                                ""
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "language": "markdown",
            "source": [
                "### Evaluate"
            ],
            "outputs": []
        },
        {
            "language": "typescript",
            "source": [
                "const currentMetrics = await model.evaluate(\r\n  tf.tensor2d(xTest),\r\n  tf.tensor2d(yTest)\r\n);\r\nif (Array.isArray(currentMetrics)) {\r\n  const ce = await Promise.all(currentMetrics.map((e) => e.array()));\r\n\r\n  const obj = ce.reduce((r, c, i) => ({ [i]: c, ...r }), { cycle });\r\n  metrics.push(obj);\r\n} else {\r\n  metrics.push({ cycle, 0: await currentMetrics.array() });\r\n}\r\nfrom(metrics.slice(-2));\r\n"
            ],
            "outputs": [
                {
                    "items": [
                        {
                            "mime": "application/vnd.code.notebook.stdout",
                            "value": [
                                "",
                                ""
                            ]
                        }
                    ]
                },
                {
                    "items": [
                        {
                            "mime": "text/html",
                            "value": [
                                "<style> table, th, tr { text-align: left; }</style><table><thead><tr><th style=\"text-align: right;\">0</th><th style=\"text-align: right;\">1</th><th style=\"text-align: right;\">cycle</th></tr></thead><tbody><tr><td style=\"text-align: right;\">0.585745</td><td style=\"text-align: right;\">0.668831</td><td style=\"text-align: right;\">1</td></tr></tbody></table>"
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "language": "typescript",
            "source": [
                "const { Plotly } = require(\"node-kernel\");\r\n\r\nconst xLabels = metrics.map(({ cycle }) => cycle);\r\nconst plotData = Object.keys(metrics[0])\r\n  .filter((key) => key !== \"cycle\")\r\n  .map((key) => ({\r\n    x: xLabels,\r\n    y: metrics.map((error) => error[key]),\r\n    mode: \"lines+markers\",\r\n    type: \"scatter\",\r\n    name: `Metric #${key}`\r\n  }));\r\n\r\nPlotly.newPlot(\"myDiv\", plotData, {\r\n  title: \"Metrics vs Train Epoch x 100\",\r\n  height: 400,\r\n  width: 600,\r\n  showlegend: true\r\n});\r\n"
            ],
            "outputs": [
                {
                    "items": [
                        {
                            "mime": "application/vnd.ts.notebook.plotly+json",
                            "value": {
                                "requestId": "xbfdecbc7d36246e485beacd9644eee5a",
                                "type": "generatePlot",
                                "ele": "myDiv",
                                "data": [
                                    {
                                        "x": [
                                            1,
                                            2,
                                            3,
                                            4,
                                            5
                                        ],
                                        "y": [
                                            -0.28234797716140747,
                                            -0.4082781672477722,
                                            -0.4462427496910095,
                                            -0.4551856219768524,
                                            -0.4590561091899872
                                        ],
                                        "mode": "lines+markers",
                                        "type": "scatter",
                                        "name": "Metric #0"
                                    },
                                    {
                                        "x": [
                                            1,
                                            2,
                                            3,
                                            4,
                                            5
                                        ],
                                        "y": [
                                            0.649350643157959,
                                            0.7402597665786743,
                                            0.7272727489471436,
                                            0.7402597665786743,
                                            0.7337662577629089
                                        ],
                                        "mode": "lines+markers",
                                        "type": "scatter",
                                        "name": "Metric #1"
                                    }
                                ],
                                "layout": {
                                    "title": "Metrics vs Train Epoch x 100",
                                    "height": 400,
                                    "width": 600,
                                    "showlegend": true
                                }
                            }
                        }
                    ]
                },
                {
                    "items": [
                        {
                            "mime": "application/vnd.code.notebook.stdout",
                            "value": [
                                "",
                                ""
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "language": "markdown",
            "source": [
                "## Prediction"
            ],
            "outputs": []
        },
        {
            "language": "javascript",
            "source": [
                "const testIndex = 0;\r\nconst pred = await model\r\n  .predict(tf.tensor2d([xTest[testIndex]]))\r\n  .squeeze()\r\n  .round()\r\n  .array();\r\n  \r\nconsole.log(`${pred} vs ${yTest[testIndex]}`);\r\nshowGrayscaleImage(xTest[testIndex], 28, 28);\r\n"
            ],
            "outputs": [
                {
                    "items": [
                        {
                            "mime": "application/vnd.code.notebook.stdout",
                            "value": [
                                "",
                                ""
                            ]
                        }
                    ]
                },
                {
                    "items": [
                        {
                            "mime": "text/plain",
                            "value": [
                                "\u001b[32m'[0,0.8994974874371859,0.4098360655737705,0.36363636363636365,0.1879432624113475,0.5633383010432191,0.1609735269000854,0.016666666666666666] => [1,0] vs [1,-1]'\u001b[39m"
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}